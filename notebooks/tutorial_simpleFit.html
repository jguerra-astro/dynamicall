
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial: Simple Fit &#8212; dynamicAll 1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "tags": "ams", "useLabelIds": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/tutorial_simpleFit';</script>
    <link rel="canonical" href="https://jguerra-astro.github.io/dynamicall/notebooks/tutorial_simpleFit.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">dynamicAll 1.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../Installation.html">
    Installation Instructions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_potential.html">
    Tutorial: Potentials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_plummer.html">
    Tutorial: Plummer Model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_jfactors.html">
    Tutorial: J-Factors
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../modules.html">
    dynamicAll
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jguerra-astro/dynamicall" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../Installation.html">
    Installation Instructions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_potential.html">
    Tutorial: Potentials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_plummer.html">
    Tutorial: Plummer Model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_jfactors.html">
    Tutorial: J-Factors
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../modules.html">
    dynamicAll
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jguerra-astro/dynamicall" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Tutorial: Simple Fit</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-simple-fit">
<h1>Tutorial: Simple Fit<a class="headerlink" href="#tutorial-simple-fit" title="Link to this heading">#</a></h1>
<p>This will be the main tutorial for <span class="math notranslate nohighlight">\(\rm dynamicall^{TM}\)</span>, a package for fitting dynamical mass models to kinematic data (It does other stuff too) <!-- TODO: Add link to other parts of the documentation --></p>
<p>We’ll go over the basics of how to use the package and then go into more detail about how to use the different parts of the package in other tutorials</p>
<p>The <strong>default case</strong> for the package assumes that you are trying to fit data from observations of a local group dwarf spheroiodal galaxy i.e. projected positions and line of sight velocities of stars.</p>
<p>This means a couple of things regarding defaults values (on the priors).
We Assume that the observations which you have are stars which contribute a negligible amount to the total mass of the system i.e. `masslesss’ tracers, which are embedded in a dark matter halo.</p>
<p>Although you have complete control over the parametrizations and therefore priors which you use, based on previous works we have a set of models and priors which maybe convenient for you to use and which should work with the base case as define above.</p>
<p>(If there is a parametrization of some parameter which is not already included it is particularly easy to define a new model which can then be used with dynamicall)</p>
<p><em>Hopefully there is a tutorial on how to do this.</em></p>
<p>First start with the imports</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;XLA_FLAGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;--xla_force_host_platform_device_count=2&#39;</span>
<span class="kn">import</span> <span class="nn">numpyro</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">enable_x64</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">jax._src.config</span> <span class="kn">import</span> <span class="n">config</span>
<span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="tl-dr">
<h2>TL;DR<a class="headerlink" href="#tl-dr" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jax</span><span class="o">.</span><span class="n">local_device_count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jax</span><span class="o">.</span><span class="n">devices</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[CpuDevice(id=0), CpuDevice(id=1)]
</pre></div>
</div>
</div>
</div>
<p>You should pretty much always enable double precision when using this package.</p>
<p>If it becomes annoying to keep typing it in every notebook, you can add it to your .zshrc file (or whatever appropriate file for your shell)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">JAX_ENABLE_X64</span><span class="o">=</span>True
</pre></div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># use my stylesheet</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;/Users/juan/phd/matplotlib/jdefault.mplstyle&#39;</span><span class="p">)</span> <span class="c1"># this should be changed something in the repo</span>

<span class="c1">#sampling and inference</span>
<span class="c1"># import numpyro</span>
<span class="kn">from</span> <span class="nn">numpyro.diagnostics</span> <span class="kn">import</span> <span class="n">hpdi</span>
<span class="kn">import</span> <span class="nn">numpyro.distributions</span> <span class="k">as</span> <span class="nn">dist</span>
<span class="kn">from</span> <span class="nn">numpyro</span> <span class="kn">import</span> <span class="n">handlers</span>
<span class="kn">from</span> <span class="nn">numpyro.infer</span> <span class="kn">import</span> <span class="n">MCMC</span><span class="p">,</span> <span class="n">NUTS</span>

<span class="c1">#need to get rid of</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># project</span>
<span class="kn">from</span> <span class="nn">dynamicAll</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span><span class="n">fit</span><span class="p">,</span><span class="n">data</span>
<span class="kn">from</span> <span class="nn">dynamicAll.fit</span> <span class="kn">import</span> <span class="n">Fit</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First load mock data</span>
<span class="c1"># TODO: use mock data from the package,you idiot</span>
<span class="c1"># Lets read in some mock data -- we can also generate fake data for a wide variety of models.</span>
<span class="n">dataSet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../notebooks/data/gs010_bs050_rcrs025_rarcinf_cusp_0064mpc3_df_1000_3_err.dat&#39;</span><span class="p">)</span>
<span class="c1"># Theres no error column in this data set, but we can just add it.</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">dataSet</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="mf">2.0</span><span class="p">)</span>
<span class="c1"># append error to dataSet</span>
<span class="n">dataSet</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span>
</pre></div>
</div>
</div>
</div>
<p>If only one error is provided I’ll assume thats the error for each component of the velocity.
Otherwise you should append an error for each component of the velocity.</p>
<p><strong>The naming convention is ‘d_’ + component name.</strong></p>
<p><strong>So for example, if you have a velocity component called ‘vz’ then the error should be called ‘d_vz’</strong></p>
<p><strong>NOTE: If you provide the error for one component, you must supply them for all velocity component</strong></p>
<p>The error on the positions seems to alway be neglected since its usually small so we’ll keep ignoring it.</p>
</section>
<section id="the-data-class">
<h2>1. The Data class<a class="headerlink" href="#the-data-class" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dynamicAll</span> <span class="kn">import</span> <span class="n">data</span>
</pre></div>
</div>
<p>The data module contains a wrapper for your data and comes with several helper functions to visualize the data.
This could help with picking a better parametrization for your model if the default ones arent giving great answers or if you are unsure what to use.</p>
<p>Currently there are three subclassses of the data class,</p>
<ul class="simple">
<li><p>MockData</p></li>
<li><p>DCJLData <!--TODO: change this to simulation data --></p></li>
<li><p>KeckData</p></li>
</ul>
<p>Lets start with using mock data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">MockData</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="spatial-data">
<h3>Spatial data<a class="headerlink" href="#spatial-data" title="Link to this heading">#</a></h3>
<p>The first thing you might want to do is look at the spatial data and velocity dispersion.
This might influence the particular models you pick for the the tracers and the potential – and if you have proper motions the velocity anisotropy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R_center</span><span class="p">,</span><span class="n">nu</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">spatial_density</span><span class="p">()</span> <span class="c1"># dumb name, should change it.</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">R_center</span><span class="p">,</span><span class="n">nu</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;R [kpc]&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\rm\Sigma(R)~N~kpc^{-3}$&#39;</span><span class="p">,</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
<span class="p">);</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ff3ea38cc21e12692d4426a134796543dc52e9ffea9dd23c517d1d2b557d17dc.png" src="../_images/ff3ea38cc21e12692d4426a134796543dc52e9ffea9dd23c517d1d2b557d17dc.png" />
</div>
</div>
<section id="preliminary-fitting">
<h4>Preliminary fitting<a class="headerlink" href="#preliminary-fitting" title="Link to this heading">#</a></h4>
<p>You can try fitting a plummer, or other model to this data.</p>
<p>Scipy’s curve fit is good enough to do this for a simple model like a plummer sphere.
Since the observational data will usually be projected positions, we’ll stick to those.</p>
<p>In this case we’ll fit our projected data to a plummer sphere.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="o">.</span><span class="n">Plummer</span><span class="o">.</span><span class="n">projection</span><span class="p">()</span>
</pre></div>
</div>
<p>If you want something more – non parametric, you could</p>
<ol class="arabic simple">
<li><p>fit a sum of gaussians to the data – Thats possible</p></li>
<li><p>Use B-splines to fit the data.</p></li>
</ol>
<p>Depending on your goals one or the other may prove more useful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define function you want to fit the data to</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Plummer</span><span class="o">.</span><span class="n">_projection</span>
<span class="c1"># plot curve_fit of curve</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span><span class="n">popt</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">fit_projection</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>

<span class="c1"># plot B-spline fit</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_center</span><span class="p">,</span><span class="n">system</span><span class="o">.</span><span class="n">bspline_projected</span><span class="p">(</span><span class="n">R_center</span><span class="p">),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;B-spline fit&#39;</span><span class="p">)</span>
<span class="c1"># plot truth</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">R_center</span><span class="p">,</span><span class="n">models</span><span class="o">.</span><span class="n">Plummer</span><span class="o">.</span><span class="n">_projection</span><span class="p">(</span><span class="n">R_center</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">0.25</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;truth&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span> <span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d9b216184a396b032694e5c5990db4952dcbd4b637ecc7642faae5b6df9d460a.png" src="../_images/d9b216184a396b032694e5c5990db4952dcbd4b637ecc7642faae5b6df9d460a.png" />
</div>
</div>
<p>What may prove more Useful is to use the photometry to fit the photometry in order to calculate the surface brightness profile. The use those constraints in order to put priors on the tracer density profile, or even fix it all together. This part should be well constrained even with a few stars so it shouldnt affect the results very much.</p>
</section>
</section>
</section>
<section id="velocity-data">
<h2>Velocity data<a class="headerlink" href="#velocity-data" title="Link to this heading">#</a></h2>
<section id="mass-estimator-e-g-rm-m-wolf">
<h3>Mass Estimator e.g. <span class="math notranslate nohighlight">\(\rm M_{Wolf}\)</span><a class="headerlink" href="#mass-estimator-e-g-rm-m-wolf" title="Link to this heading">#</a></h3>
<p>The simplest thing you might want to do with the velocity data is calculate the velocity dispersion (Average velocity dispersion of your data) and calculate a mass estimate at the half-light radius.</p>
<p>You can do both</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mean_vdisp</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">velocity_dispersion</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;los&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wolf_mass</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">mass_estimator</span><span class="p">(</span><span class="s1">&#39;Wolf&#39;</span><span class="p">,</span><span class="n">rhalf</span><span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
<p>If you prefer a different mass estimator, I’ve included the “Walker” estimator which should give you a similar answer.
If you have proper motions, you could use the mass “Errani” mass estimator as well</p>
<p>Since we’re dealing with mock data at the moment we do have all the components so lets estimate all of them</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wolf_mass = system.mass_estimator(&#39;Wolf&#39;,rhalf= 0.25) # If you&#39;re data set has rhalf in it. You dont need to supply it, but it&#39;ll work either way</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="velocity-dispersion-rm-sigma-los-r">
<h3>velocity dispersion: <span class="math notranslate nohighlight">\(\rm\sigma_{los}(R)\)</span><a class="headerlink" href="#velocity-dispersion-rm-sigma-los-r" title="Link to this heading">#</a></h3>
<p>If you have sufficient data (<span class="math notranslate nohighlight">\(N_{\star}\sim 10^{3}\)</span>) It may be useful to inspect the velocity dispersion as a function of radius.</p>
<p>We offer to versions of doing this, Either using binning which works well with a large number of stars, or non-parametrically using B-splines.</p>
<p>Since we’re using mock data we have every component, so lets walk through some of the data products you can make.</p>
<p>A simple calculation you can do is the calculate the velocity dispersion as a function of radius.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">dispersion</span><span class="p">(</span><span class="n">ri</span><span class="p">,</span><span class="n">vi</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">component</span><span class="p">,</span><span class="n">bin_func</span><span class="p">,</span><span class="n">bins</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns three things,</p>
<ul class="simple">
<li><p>r_center</p></li>
<li><p>dispersion</p></li>
<li><p>dispersion_error</p></li>
</ul>
<p>If that’s too much writing, you can instead call dispersion_i() which takes a component argument and returns the corresponding dispersion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">dispersion_i</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;los&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or if you have 6D data and want to find the dispersion in each of the spherical components</p>
<ul class="simple">
<li><p>‘radial’</p></li>
<li><p>‘theta’</p></li>
<li><p>‘phi’</p></li>
</ul>
<p>or if you have 5D – 2D spatial data (propjected position “R”) + 3D  velocity (i.e. proper motions) — you can calculate the two additional dispersions</p>
<ul class="simple">
<li><p>‘pmr’</p></li>
<li><p>‘pmt’</p></li>
</ul>
<p>When you first initialize the data class, it’ll tell you which components are available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_center</span><span class="p">,</span><span class="n">dispersion</span><span class="p">,</span><span class="n">error</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispersion_i</span><span class="p">(</span><span class="n">component</span> <span class="o">=</span><span class="s1">&#39;los&#39;</span><span class="p">)</span>

<span class="c1"># Or if you just want to plot it</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">system</span><span class="o">.</span><span class="n">plot_dispersion_i</span><span class="p">(</span><span class="n">component</span> <span class="o">=</span><span class="s1">&#39;los&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9baadf40077f6ca7b7b2a69bd98a961d445cc0a4ea7a3a90ed2b07095f575419.png" src="../_images/9baadf40077f6ca7b7b2a69bd98a961d445cc0a4ea7a3a90ed2b07095f575419.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># method 1 </span>
<span class="n">r_center</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">,</span><span class="n">error</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">dispersion</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">_R</span><span class="p">,</span><span class="n">system</span><span class="o">.</span><span class="n">_vz</span><span class="p">,</span><span class="n">system</span><span class="o">.</span><span class="n">_error</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">r_center</span><span class="p">,</span><span class="n">dispersion</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">r_center</span><span class="p">,</span><span class="n">dispersion</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;R [kpc]&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span> <span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{los}</span><span class="s1">$ [km/s]&#39;</span><span class="p">,</span>
    <span class="n">ylim</span>   <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9baadf40077f6ca7b7b2a69bd98a961d445cc0a4ea7a3a90ed2b07095f575419.png" src="../_images/9baadf40077f6ca7b7b2a69bd98a961d445cc0a4ea7a3a90ed2b07095f575419.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">_cached_dispersion</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;los&#39;: (Array([ 0.02635787,  0.16527294,  0.33146564,  0.42925691,  0.64295691,
          1.18709929,  2.98829428, 10.7779965 ], dtype=float64),
  Array([13.378401  , 11.32803371, 12.46153614, 10.41200497, 11.09698437,
         12.22271395, 12.16343862, 10.66029099], dtype=float64),
  Array([1.15016566, 0.27595601, 0.54962351, 0.62772577, 0.54649566,
         0.80806626, 1.4332354 , 4.03212505], dtype=float64))}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="o">.</span><span class="n">_cached_dispersion</span><span class="p">[</span><span class="s1">&#39;los&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([ 0.02635787,  0.16527294,  0.33146564,  0.42925691,  0.64295691,
        1.18709929,  2.98829428, 10.7779965 ], dtype=float64)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="jeans-modeling">
<h2>Jeans Modeling<a class="headerlink" href="#jeans-modeling" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">dynamicAll</span> <span class="kn">import</span> <span class="n">models</span>
</pre></div>
</div>
<p>models contains all of the built in parameterization of models we will use to fit the data.</p>
<p>As expected from this mock data, generated from the velocity dispersion profile of Draco, we see that the velocity dispersion is roughly constant with radius at around <span class="math notranslate nohighlight">\(12.5\rm~km~s^{-1}\)</span></p>
<p>For our Jeans Modeling we need to initialize our Fit class</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_cls</span> <span class="o">=</span> <span class="n">Fit</span><span class="p">()</span>
<span class="c1"># fit_cls  = Fit(tracer_model,dm_model,anisotropy_model)</span>
<span class="c1"># output = fit_cls.fit(data=data)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UserWarning: 
No tracer model defined.
Using default Plummer model.

UserWarning: 
No DM model defined.
Using default HernquistZhao model.

UserWarning: 
No anisotropy model defined.
using default BetaConstant model

UserWarning: 
No priors defined.
Using default priors for each model
</pre></div>
</div>
</div>
</div>
<p>If you call it this way you are using the default values for all parameters and priors.
This is equivalent to initializing the model as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">priors</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">Priors</span><span class="p">()</span>

<span class="n">tracer_model</span>     <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Plummer</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span><span class="mf">1e5</span><span class="p">))</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e3</span><span class="p">))</span>

<span class="n">dm_model</span>         <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">HernquistZhao</span>

<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;rhos&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">anisotropy_model</span>  <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BetaConstant</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;beta0&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">priors</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">Priors</span><span class="p">()</span>

<span class="n">tracer_model</span>     <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Plummer</span>
<span class="n">dm_model</span>         <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">gNFW</span>

<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;dm_rhos&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="mf">1e5</span><span class="p">,</span><span class="mf">1e11</span><span class="p">))</span>
<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;dm_rs&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">LogUniform</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span><span class="mf">1e1</span><span class="p">))</span>

<span class="n">priors</span><span class="o">.</span><span class="n">add_prior</span><span class="p">(</span><span class="s1">&#39;dm_gamma&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">anisotropy_model</span>  <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BetaConstant</span>
<span class="c1"># priors.add_prior(&#39;beta_0&#39;, dist.Uniform(-1,1))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Array(0.04978707, dtype=float64, weak_type=True),
 Array(7.3890561, dtype=float64, weak_type=True))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_cls</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">SphGalaxy</span><span class="p">(</span><span class="n">priors</span><span class="o">=</span><span class="n">priors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UserWarning: 
No tracer model defined.
Using default Plummer model.

UserWarning: 
No DM model defined.
Using default HernquistZhao model.

UserWarning: 
No anisotropy model defined.
using default BetaConstant model
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_cls</span><span class="o">.</span><span class="n">_priors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameter: dm_rhos, Distribution: LogUniform, Bounds: (1.00e+05, 1.00e+11)
Parameter: dm_rs, Distribution: LogUniform, Bounds: (1.00e-02, 1.00e+01)
Parameter: dm_gamma, Distribution: Uniform, Bounds: (-2.00e+00, 2.00e+00)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Because this is our tracer model, we only have to define a prior on the scale radius of the tracer population, but we’ll still define a prior on the total “Mass” of the tracers, but it’s ultimately just the number of tracers.
We’ll assume a uniform prior on the logarithm of the scale radius, with limits of 0.1 and 10 kpc.
There’s a somewhat convenient Priors class that we can use to define our priors on each component of our model.
The default priors are based on previous authors works,  e.g. <a class="reference external" href="https://academic.oup.com/mnras/article/507/4/4715/6358538">(Chang et. al.)</a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{lc}
\hline \text { Parameter } &amp; \text { Prior } \\
\hline \log _{10}\left(r_* / \mathrm{kpc}\right) &amp; {[-3,3]} \\
\log _{10}\left(L / L_{\odot}\right) &amp; {[-2,5]} \\
\ln \left(\rho_0 /\left(M_{\odot} \mathrm{kpc}^{-3}\right)\right) &amp; {[5,30]} \\
\left.\ln \left(r_s / \mathrm{kpc}\right)^{-1}\right) &amp; {[-10,10]} \\
\bar{v} /\left(\mathrm{km} \mathrm{s}^{-1}\right) &amp; {[-100,100]} \\
\gamma &amp; {[-1,5]} \\
\hline
\end{array}
\end{split}\]</div>
<p>The LogUniform distribution is a distribution over positive reals that is uniform in log space. It is useful for fitting parameters that naturally live on a log scale. Note that the distribution is the same regardless of the base of the logarithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcmc</span> <span class="o">=</span> <span class="n">fit_cls</span><span class="o">.</span><span class="n">fit_dSph</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">system</span><span class="p">,</span>
            <span class="n">num_chains</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d9ef965989854f1ca03c3ec0a6f3dc90", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "c103b87bc7df4b77a6d32e46499686e0", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>If you’re running this on your laptop – you may get a warning about the number of cores you’re using.
You can ignore this for now, although if you find the time to run this becoming large you may consider using a cluster with GPUs or TPUs to speed up the fitting process.</p>
<p>We’ll user arviz and corner to visualize the results of our fit.
However, if you just want the samples you can write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">mcmc</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>

<span class="n">inf_data</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_numpyro</span><span class="p">(</span><span class="n">mcmc</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">inf_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dm_gamma</th>
      <td>1.100000e+00</td>
      <td>4.940000e-01</td>
      <td>0.286</td>
      <td>1.683000e+00</td>
      <td>0.018</td>
      <td>0.013</td>
      <td>875.0</td>
      <td>783.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>dm_rhos</th>
      <td>5.948310e+07</td>
      <td>6.015588e+07</td>
      <td>5969433.961</td>
      <td>1.469989e+08</td>
      <td>2299320.312</td>
      <td>1641480.300</td>
      <td>863.0</td>
      <td>778.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>dm_rs</th>
      <td>1.496000e+00</td>
      <td>1.067000e+00</td>
      <td>0.355</td>
      <td>2.985000e+00</td>
      <td>0.038</td>
      <td>0.027</td>
      <td>865.0</td>
      <td>808.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">inf_data</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
            <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
            <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="c1"># title_fmt=&#39;.2e&#39;,</span>
            <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">6.4e7</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1"># ax[2,1].set(</span>
    <span class="c1"># xlim=(1e5,1e8),</span>
    <span class="c1"># xscale=&#39;log&#39;</span>
<span class="c1"># )</span>
<span class="c1"># ax = ax.flatten()</span>
<span class="c1"># ax[3].set(</span>
<span class="c1">#     yscale=&#39;log&#39;</span>
<span class="c1"># )</span>
<span class="c1"># ax[7].set(</span>
<span class="c1">#     xscale=&#39;log&#39;</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Too few points to create valid contours
</pre></div>
</div>
<img alt="../_images/442cb2d11fd3faad0a825321e64939db4304ab9e8d5873988716d860e8d78691.png" src="../_images/442cb2d11fd3faad0a825321e64939db4304ab9e8d5873988716d860e8d78691.png" />
</div>
</div>
<p>Now output is itself a class, with various convenience methods that will plot the results</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tl-dr">TL;DR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data-class">1. The Data class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-data">Spatial data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminary-fitting">Preliminary fitting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-data">Velocity data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mass-estimator-e-g-rm-m-wolf">Mass Estimator e.g. <span class="math notranslate nohighlight">\(\rm M_{Wolf}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-dispersion-rm-sigma-los-r">velocity dispersion: <span class="math notranslate nohighlight">\(\rm\sigma_{los}(R)\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jeans-modeling">Jeans Modeling</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/notebooks/tutorial_simpleFit.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Juan Guerra.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>