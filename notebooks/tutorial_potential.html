
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial: Potentials &#8212; dynamicAll 1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "tags": "ams", "useLabelIds": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/tutorial_potential';</script>
    <link rel="canonical" href="https://jguerra-astro.github.io/dynamicall/notebooks/tutorial_potential.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial: Plummer Model" href="tutorial_plummer.html" />
    <link rel="prev" title="Defining a Potential" href="numerical_methods.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">dynamicAll 1.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../Installation.html">
    Installation Instructions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="numerical_methods.html">
    Defining a Potential
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Tutorial: Potentials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_plummer.html">
    Tutorial: Plummer Model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_jfactors.html">
    Tutorial: J-Factors
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="tutorial_dracoish.html">
    Tutorial: Numpyro
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../modules.html">
    dynamicAll
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jguerra-astro/dynamicall" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../Installation.html">
    Installation Instructions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="numerical_methods.html">
    Defining a Potential
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Tutorial: Potentials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_plummer.html">
    Tutorial: Plummer Model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_jfactors.html">
    Tutorial: J-Factors
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial_dracoish.html">
    Tutorial: Numpyro
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../modules.html">
    dynamicAll
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/jguerra-astro/dynamicall" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tutorial: Potentials</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-potentials">
<h1>Tutorial: Potentials<a class="headerlink" href="#tutorial-potentials" title="Link to this heading">#</a></h1>
<p>Almost all potentials are define through a set of scale density and radii (and a set of shape parameters if the parameterization calls for it)</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># third party</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;/Users/juan/phd/matplotlib/jdefault.mplstyle&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">jax._src.config</span> <span class="kn">import</span> <span class="n">config</span>

<span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">dynamicAll</span> <span class="kn">import</span> <span class="n">models</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Currently we have the following potentials implemented:</p>
<ul class="simple">
<li><p>Hernquist</p></li>
<li><p>NFW</p></li>
<li><p>gNFW</p></li>
<li><p>Einasto</p></li>
<li><p>Plummer</p></li>
<li><p>Isochrone</p></li>
<li><p>Jaffe</p></li>
<li><p>Gaussian</p></li>
<li><p>King</p></li>
</ul>
<p>Below we’ll showcase a few examples and how they are used as well as caveats you should be aware of – which are mostly things about jax that you should be aware of.</p>
<section id="double-power-laws">
<h2>Double Power Laws<a class="headerlink" href="#double-power-laws" title="Link to this heading">#</a></h2>
<section id="hernquist">
<h3>Hernquist<a class="headerlink" href="#hernquist" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Herquist Parameters</span>
<span class="n">rhos</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">rs</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">hernquist_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rhos&quot;</span><span class="p">:</span> <span class="n">rhos</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">:</span> <span class="n">rs</span><span class="p">}</span>

<span class="n">hernquist</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Hernquist</span><span class="p">(</span><span class="o">**</span><span class="n">hernquist_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="jaffe">
<h3>Jaffe<a class="headerlink" href="#jaffe" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rhos = 6.4e4</span>
<span class="c1"># rs = 1.0</span>
<span class="n">jaffe_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rhos&quot;</span><span class="p">:</span> <span class="n">rhos</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">:</span> <span class="n">rs</span><span class="p">}</span>

<span class="n">jaffe</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Jaffe</span><span class="p">(</span><span class="o">**</span><span class="n">jaffe_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plummer">
<h3>Plummer<a class="headerlink" href="#plummer" title="Link to this heading">#</a></h3>
<section id="note">
<h4>Note:<a class="headerlink" href="#note" title="Link to this heading">#</a></h4>
<p>I’ve tried to keep naming schemes as initializations as consistent as possible.
Almost every potential is by default initialized with some scale density and radius “rhos”, and “rs” respectively. However some models are defined in terms of their mass and scale radius so you should be aware of the initialization parameters for each potential. There are alternative initialization (see the Documentation of each potential to see the alternative initializations).</p>
<p>An example of this is the Plummer sphere where its usually defined in terms of its total mass and scale radius</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># M = 1e3</span>
<span class="c1"># # rs = 1.0</span>
<span class="c1"># plummer_params = {&quot;M&quot;: M, &quot;rs&quot;: rs}</span>
<span class="c1"># plummer = models.Plummer(**plummer_params)</span>
<span class="c1"># print(plummer._rhos)</span>
<span class="c1"># Altenative initialization</span>

<span class="c1"># rhos = plummer._rhos  # use the scale radius from the previous model</span>
<span class="n">alt_init_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rhos&quot;</span><span class="p">:</span> <span class="n">rhos</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">:</span> <span class="n">rs</span><span class="p">}</span>
<span class="n">plummer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Plummer</span><span class="o">.</span><span class="n">from_scale_density_radius</span><span class="p">(</span><span class="o">**</span><span class="n">alt_init_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="navaro-frenk-white-nfw">
<h3>Navaro-Frenk-White (NFW)<a class="headerlink" href="#navaro-frenk-white-nfw" title="Link to this heading">#</a></h3>
<p>Note: This model has several ways of initializing it.</p>
<p>from</p>
<ul class="simple">
<li><p>a scale mass and radius –this is how it’s defined in <a class="reference external" href="http://gala.adrian.pw/en/latest/api/gala.potential.potential.NFWPotential.html">Gala</a></p></li>
<li><p><span class="math notranslate nohighlight">\(M_{\Delta}\)</span> and a concentration parameter where <span class="math notranslate nohighlight">\(M_{\Delta}\)</span> is the mass enclosed within a radius <span class="math notranslate nohighlight">\(\Delta\)</span> times the critical density of the universe and the concentration parameter is the ratio of <span class="math notranslate nohighlight">\(r_{\Delta}\)</span> to the scale radius.</p></li>
</ul>
<p>I’ll add more initializations if they’re relevant.</p>
<p>See the documentation for more details</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model parameters</span>
<span class="c1"># NFW</span>
<span class="c1"># rhos = 6.4e4  # scale density in Msun/kpc^3</span>
<span class="c1"># rs = 1.0  # scale radius in kpc</span>
<span class="n">nfw</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hz_plummer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">HernquistZhao</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">_rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">hz_nfw</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">HernquistZhao</span><span class="p">(</span><span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">hz_hernquist</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">HernquistZhao</span><span class="p">(</span><span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">hz_jaffe</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">HernquistZhao</span><span class="p">(</span><span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># * Density plots</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">hernquist</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">jaffe</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">nfw</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">plummer</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">hz_plummer</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">hz_nfw</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao NFW&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist-Zhao equivalent&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">hz_jaffe</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Jaffe&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho(r)~\rm [M_{\odot}kpc^{-3}]$&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Density&quot;,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="c1"># * log-slope plots</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hernquist</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jaffe</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao NFW&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Hernquist&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Jaffe&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\gamma = -\frac{d\ln{\rho}}{d\ln</span><span class="si">{r}</span><span class="s2">}$&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># * Mass plots</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">hernquist</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">jaffe</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">nfw</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">plummer</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao NFW&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Hernquist&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass_scipy</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;M(r) $\rm [M_{\odot}]$&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Mass&quot;,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># * Potential plots</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">hernquist</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">)</span>
<span class="n">jaff_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rhos&quot;</span><span class="p">:</span> <span class="n">rhos</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">:</span> <span class="n">rs</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">}</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">jaffe</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">)</span>
<span class="c1"># ax[3].plot(r, -jaffe.test_potential(r, jaff_params), label=&quot;Jaffe&quot;)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">nfw</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">plummer</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao NFW&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Hernquist&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="o">-</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">_potential</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">r</span><span class="p">,</span> <span class="n">jaff_params</span><span class="p">),</span>
    <span class="c1"># label=&quot;HernquistZhao Jaffe&quot;,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ax[3].plot(</span>
<span class="c1">#     r,</span>
<span class="c1">#     hz_jaffe.potential_scipy(r),</span>
<span class="c1">#     linestyle=&quot;-.&quot;,</span>
<span class="c1">#     color=&quot;pink&quot;,</span>
<span class="c1"># )</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="c1"># xlim=(1e-2, 1e4),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$-\Phi~\rm [km^2s^{-2}]$&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># ! Weird quirk on the NFW mass profile since it&#39;s analytic.</span>
<span class="c1"># ! Maybe the log term is not well behaved for small radii.</span>
<span class="c1"># TODO I&#39;ll have to check this out later, but i don&#39;t see the mass at that small radii being super relevant</span>
<span class="c1"># maybe taylor expand for small radii? ln(1+q) = q - q^2/2 + ... q = r/rs &lt;&lt; 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x32dc3ef90&gt;
</pre></div>
</div>
<img alt="../_images/5a26661600b8ddebadf37c9ea39396e3d85073692014763242659bca7b330389.png" src="../_images/5a26661600b8ddebadf37c9ea39396e3d85073692014763242659bca7b330389.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">test_potential</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">jaff_params</span><span class="p">),</span> <span class="n">jaffe</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Array(-0.00027926, dtype=float64), Array(-0.00023751, dtype=float64))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># plot abs of difference</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hernquist</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jaffe</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_jaffe</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_nfw</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_plummer</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$|\rho_{\rm model} - \rho_{\rm HZ}|$&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Density&quot;,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hernquist</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hernquist&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jaffe</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">gamma</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$|\gamma_{\rm model} - \gamma_{\rm HZ}|$&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ax[2].plot(</span>
<span class="c1">#     r,</span>
<span class="c1">#     jnp.abs(hernquist.mass(r) - jax.vmap(hz_hernquist.mass)(r)),</span>
<span class="c1">#     label=&quot;Hernquist&quot;,</span>
<span class="c1"># )</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hernquist</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass_scipy</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass_scipy</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rhos</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">hz_hernquist</span><span class="o">.</span><span class="n">mass_quad</span><span class="p">(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jaffe</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">mass</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">mass</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$|M_{\rm model} - M_{\rm HZ}|$&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Mass&quot;,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jaffe</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_jaffe</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hernquist</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_hernquist</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Jaffe&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_nfw</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NFW&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">r</span><span class="p">,</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">plummer</span><span class="o">.</span><span class="n">potential</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">hz_plummer</span><span class="o">.</span><span class="n">potential</span><span class="p">)(</span><span class="n">r</span><span class="p">)),</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plummer&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">),</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$|\Phi_{\rm model} - \Phi_{\rm HZ}|$&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[None,
 None,
 (0.01, 100.0),
 Text(0.5, 0, &#39;r [kpc]&#39;),
 Text(0, 0.5, &#39;$|\\Phi_{\\rm model} - \\Phi_{\\rm HZ}|$&#39;)]
</pre></div>
</div>
<img alt="../_images/9b57f349af8a7e0d0a3be0bd0b4ada4660c072c971187082c8f756b077942eb6.png" src="../_images/9b57f349af8a7e0d0a3be0bd0b4ada4660c072c971187082c8f756b077942eb6.png" />
</div>
</div>
<p>All of these quantities are analytically defined so they’ll be useful for testing our numerical methods.
Particularly for our Hernquist-Zhao Potential, where none of the quantities (besides the density profile) are analytically defined.</p>
</section>
<section id="total-mass">
<h3>Total Mass<a class="headerlink" href="#total-mass" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hernquist: total mass =  </span><span class="si">{</span><span class="n">hernquist</span><span class="o">.</span><span class="n">_M</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Msun&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jaffe:     total mass =  </span><span class="si">{</span><span class="n">jaffe</span><span class="o">.</span><span class="n">_M</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Msun&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NFW:       total mass =  </span><span class="si">{</span><span class="n">nfw</span><span class="o">.</span><span class="n">_M</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Msun&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plummer:   total mass =  </span><span class="si">{</span><span class="n">plummer</span><span class="o">.</span><span class="n">_M</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> Msun&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hernquist: total mass =  5.03e+01 Msun
Jaffe:     total mass =  1.01e+02 Msun
NFW:       total mass =  1.59e-07 Msun
Plummer:   total mass =  3.35e+01 Msun
</pre></div>
</div>
</div>
</div>
<p>Note: The mass for NFW profile diverges as <span class="math notranslate nohighlight">\(r \to \infty\)</span> so a cut off radius is needed to define a “total mass”.
There is a default paramter rlim that is set to ‘r200’ which is the radius at which the mean density is 200 times the critical density of the universe.
However you can set this to any value you like.
This will be the case for all potentials that diverge at large radii i.e. all density profiles in which <span class="math notranslate nohighlight">\(\rho(r)\sim r^{c}\)</span> for <span class="math notranslate nohighlight">\(c \le -3\)</span>.</p>
<p>Depending on your needs it might be convenient to define your potential through a concentration parameter, c and <span class="math notranslate nohighlight">\(\rm M_{200}\)</span></p>
</section>
</section>
<section id="binned-power-laws">
<h2>Binned Power Laws<a class="headerlink" href="#binned-power-laws" title="Link to this heading">#</a></h2>
<p>If you’ve used Gravsphere you may want to use the same scheme for the potential. Its essentially a broken power law with more breaks then usual and without the smooothing factor as in the Hernquist-Zhao Model.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\rho(r) = \rho_{s} 
\begin{cases}
    \left(\frac{r}{0.25R_{1/2}}\right)^{\gamma} &amp; r \lt 0.25 R_{1/2} \\
    \left(\frac{r}{0.5R_{1/2}}\right)^{\beta}
        \left(\frac{0.5 R_{1/2}}{0.25 R_{1/2}}\right)^{\beta} &amp; 0.25 R_{1/2} \le r \lt 0.5 R_{1/2} \\
    \left(\frac{r}{R_{1/2}}\right)^{\delta}
        \left(\frac{R_{1/2}}{0.5 R_{1/2}}\right)^{\delta}
        \left(\frac{0.5 R_{1/2}}{0.25 R_{1/2}}\right)^{\beta} &amp; 0.5 R_{1/2} \le r \lt R_{1/2} \\
    \left(\frac{r}{2R_{1/2}}\right)^{\sigma}
        \left(\frac{2 R_{1/2}}{R_{1/2}}\right)^{\sigma}
        \left(\frac{R_{1/2}}{0.5 R_{1/2}}\right)^{\delta}
        \left(\frac{0.5 R_{1/2}}{0.25 R_{1/2}}\right)^{\beta}  &amp; R_{1/2} \le r \lt 2 R_{1/2} \\
    \left(\frac{r}{4R_{1/2}}\right)^{\alpha}
        \left(\frac{4 R_{1/2}}{2 R_{1/2}}\right)^{\alpha}
        \left(\frac{2 R_{1/2}}{R_{1/2}}\right)^{\sigma}
        \left(\frac{R_{1/2}}{0.5 R_{1/2}}\right)^{\delta}
        \left(\frac{0.5 R_{1/2}}{0.25 R_{1/2}}\right)^{\beta}  &amp; r \ge 2 R_{1/2} \\
\end{cases}
\end{split}\]</div>
<p>Where i’ve explicitly left terms uncanceled to show the reason they’re there and to make it easier to show how to generalize it to more breaks inline with how the code is written.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binnedpl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PowerLaws</span><span class="p">(</span>
    <span class="n">rhos</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">R_half</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=-</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=-</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">5.0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">binnedpl</span><span class="o">.</span><span class="n">density</span><span class="p">))(</span><span class="n">r</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r [kpc]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\rho$ [M$_{\odot}$ kpc$^{-3}$]&quot;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ebcadd70da0a1b6f948ed57319329210f7727b41099ae830e5e037bcde922c7.png" src="../_images/6ebcadd70da0a1b6f948ed57319329210f7727b41099ae830e5e037bcde922c7.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="numerical_methods.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Defining a Potential</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorial_plummer.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial: Plummer Model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#double-power-laws">Double Power Laws</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hernquist">Hernquist</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jaffe">Jaffe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plummer">Plummer</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note">Note:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#navaro-frenk-white-nfw">Navaro-Frenk-White (NFW)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-mass">Total Mass</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binned-power-laws">Binned Power Laws</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/notebooks/tutorial_potential.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Juan Guerra.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>